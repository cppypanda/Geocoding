### 单点校准标准作业流程 (SOP) - V2.0

**版本: 2.0**
**最后更新日期: 2024-07-26**

#### 1. 核心目标

本文档旨在详细说明"单点校准面板"内的所有功能。该面板是地理编码流程中精度控制的最后一环，它为用户提供一个强大的"手术台"，用于审查、对比并手动修正单个地址的地理编码结果，以确保最高质量的输出。

**核心原则：**
*   **信息透明**: 清晰展示所有候选API的结果，供用户决策。
*   **交互直观**: 提供多种直观的修正方式（点击选择、手动标记、高级工具查找）。
*   **无缝集成**: 校准操作无缝衔接结果总览表，修改即时同步。

---

#### 2. 功能模块：单点校准面板

当用户在“批量结果总览区”点击“逐条查看与校准”按钮后，此功能被激活，进入对单个地址的精细化修正模式。

*   **功能目标**: 为用户提供一个强大的"手术台"，用于审查、对比并修正单个地址的地理编码结果。

*   **界面元素**:
    *   校准区容器 (`#detailedReviewSection`)。
    *   原始地址显示区 (`#originalAddressDisplay`)。
    *   当前选定结果详情卡片 (`#selectedResultDetailCard`)。
    *   各API服务商（高德、百度、天地图）的结果卡片。
    *   校准地图 (`#itemCalibrationMap`)，位于左侧。
    *   手动标记模式切换按钮 (`#manualMarkBtnOnMap`)。
    *   地址查找工具入口按钮 (`#showAddressSearchToolsBtn`)。
    *   上一个/下一个导航按钮 (`.prev-result-btn`, `.next-result-btn`)。

*   **核心校准工作流**:
    1.  **触发**: 用户在批量结果区域内点击“逐条查看与校准”按钮，`showMainContentArea('detailedReview')` 函数被调用，校准区显示，并默认加载第一条结果进行校准。
    2.  **信息展示**:
        *   面板顶部显著位置，会始终显示当前正在校准的**原始地址**。
        *   面板右侧展示当前地址的**最终选定结果**。
        *   下方并排展示**高德、百度、天地图**各自的原始编码结果。
        *   左侧地图上，用不同图标清晰地标出上述所有结果的位置点，并自动缩放到最佳视野。
    3.  **用户修正**: 用户有多种方式修正当前结果：
        *   **A. 切换API源**: 如果认为百度地图的结果比当前选定的高德更准，直接点击百度结果卡片上的"选定"按钮即可。
        *   **B. 手动标记**: 点击"手动标记"按钮，鼠标会变成十字准星。用户可以直接在地图上单击精确位置。系统会自动对该点进行逆地址解析，并将解析结果作为新的选定地址。
        *   **C. 使用地址查找工具**: 如果现有结果均不理想，可点击“地址查找工具”按钮。这会显示下方的“地址查找工具区”，用户可以在其中使用POI搜索或智能地址情报等高级功能来寻找正确的地点。
    4.  **结果同步**:
        *   无论使用何种方式修正，一旦用户选定了新的结果，该结果会立刻更新到面板右侧的"当前选定结果"卡片中。
        *   同时，`onResultChanged` 回调函数被触发，将更新后的数据同步回总览表格，实现界面数据的实时一致性。
    5.  **完成与导航**: 用户可通过“上一个”、“下一个”按钮在批量结果中导航，或随时滚动回上方查看总览表。

*   **技术实现**:
    *   整个校准面板的UI和交互逻辑，由 `static/js/modules/calibration.js` 文件全面负责。
    *   地图交互依赖 `map.js` 模块和 `Leaflet.js` 库。
    *   所有需要后端计算的"智能"功能（手动标记逆解析等），都通过 `api.js` 中定义的函数与后端API通信。

*   **地图标记点视觉规范 (V2.0)**:
    为了在地图上清晰、直观地区分不同来源和状态的地理编码结果，所有标记点（Marker）遵循以下统一的视觉规范：

    1.  **当前选定结果标记**:
        *   **图标样式**: 使用高辨识度的 **Leaflet 默认图钉样式**，作为视觉焦点。
        *   **颜色逻辑**:
            *   **绿色图钉**: 当该结果的 `置信度` **≥ 90%** 时使用，代表这是一个高可信度的、确定的结果。
            *   **红色图钉**: 当该结果的 `置信度` **< 90%** 时使用，用以警示用户这是一个低可信度的、需要注意的结果。
        *   **状态与交互**:
            *   此标记点在校准地图上**始终可见**。
            *   默认**自动展开信息气泡(Popup)**，直接展示其详细信息。

    2.  **各平台候选结果标记**:
        *   **图标样式**: 使用 **“品牌色圆形底座 + 白色单字”** 的自定义图标，与选定结果形成明显区隔。
            *   **高德地图**: 蓝色底，白色“高”字。
            *   **百度地图**: 红色底，白色“百”字。
            *   **天地图**: 橙色底，白色“天”字。
        *   **状态与交互**:
            *   **可见性**: 仅当用户展开“显示/隐藏各平台结果与操作”面板时，这些候选标记点才会在地图上显示。
            *   **悬浮提示(Hover)**: 鼠标移动到任一圆形图标上时，会自动显示其信息气泡。
            *   **点击选定(Click)**: 用户可直接点击地图上的任一候选标记点，该点代表的结果将立即被设为“当前选定结果”，并同步更新所有相关UI。

--- 